<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Identify the cipher type to progress in the mission">
    <meta name="theme-color" content="#e94560">
    <title>Cipher Identification | CyberPuzzle.Fun</title>
    
    <link rel="preconnect" href="https://cdn.jsdelivr.net">
    <link rel="preconnect" href="https://code.jquery.com">
    
    <link rel="stylesheet" href="../style.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
</head>

<body>
    <div class="main_container">
        <header class="header">
            <div class="logo">
                <a href="../index.html" aria-label="Back to Home">
                    <img src="../puzzle1/assets/img/CyberPuzzle.Fun.png" alt="Logo" class="img-fluid">
                </a>
            </div>
            <div class="clearfix"></div>
        </header>

        <h1>Puzzle 1: Message in a Bottle</h1>
        <section class="puzzle1">
            <div id="outerContainer">
                <div class="container">
                    <p class="typing">
                        Wow - I found it! It's literally a "message in a bottle"! But it's all gibberish... It makes no
                        sense...<br>
                        Hmmm... wait a minute - I know what this is - it's a <b>transposition cipher!</b> To complete my
                        mission, I need to decode it!<br>
                        Let me see... First step to decoding it is to write this cipher text down somewhere...
                    </p>

                    <div class="hiders" aria-hidden="true">
                        <p>&nbsp;</p>
                        <p>&nbsp;</p>
                        <p>&nbsp;</p>
                        <p>&nbsp;</p>
                        <p>&nbsp;</p>
                    </div>
                </div>
                <br><br><br><br><br><br>
                
                <div id="cipher_text_input_div" class="cipher-input-section">
                    <form class="cipher_text_input_form" id="cipherForm">
                        <label for="cipher_text_input">üîê What type of cipher is this? (Hint: 2 words)</label>
                        <input type="text" 
                               placeholder="Enter cipher type..." 
                               id="cipher_text_input" 
                               name="cipher_text_input"
                               autocomplete="off"
                               aria-label="Cipher type input">
                        <input type="submit" value="Submit Answer">
                        <div id="attempt-counter" style="color: var(--text-muted); font-size: 12px; margin-top: 10px;"></div>
                    </form>
                </div>
                <br>
                
                <div id="cipher_text_note">
                    <div id="cipher_wrap">
                        <img src="../puzzle1/assets/img/cipher_img.jpg" alt="Cipher text note showing encrypted message" class="img-fluid" loading="lazy">
                        <br>
                    </div>
                </div>
            </div>
        </section>
    </div>
    
    <button class="skip-animation" onclick="skipAnimation()">‚è≠ Skip</button>
    
    <br>
    <footer>
        <h3>Richard Dobson - USQ - U1011744</h3>
    </footer>

    <div>
        <p id="copyright"><small>Copyright &copy; 2023. All Rights Reserved.</small></p>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js" 
        integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" 
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script>
    <script src="../puzzle1/dist/js/game-utils.js"></script>
    <script>
        $(document).ready(function () {
            // Reduced delays for better UX
            $("#cipher_text_note").hide().delay(6000).fadeIn(1500);
            $("#cipher_text_input_div").hide().delay(6000).fadeIn(1500);
            
            // Schedule hints
            setTimeout(() => {
                if (window.HintSystem) {
                    HintSystem.scheduleHints('puzzle1b');
                }
            }, 7000);
        });
        
        // Track attempts for progressive feedback
        let attempts = 0;
        const maxAttempts = 5;
        
        $("#cipherForm").on("submit", function (e) {
            e.preventDefault();
            attempts++;
            
            const data = $("#cipher_text_input").val().trim();
            const normalizedInput = data.toUpperCase().replace(/\s+/g, ' ');
            
            // Update attempt counter
            $("#attempt-counter").text(`Attempt ${attempts} of ${maxAttempts}`);
            
            // Check answer with fuzzy matching
            if (normalizedInput === "TRANSPOSITION CIPHER") {
                if (window.Feedback) {
                    Feedback.showSuccess('Correct! This is a transposition cipher!', 1500);
                }
                if (window.GameState) {
                    GameState.saveProgress('puzzle1b');
                }
                setTimeout(() => {
                    window.location.href = "./puzzle1c.html";
                }, 1500);
            } else {
                // Progressive hints based on attempts
                let message = `"${data}" is not the correct cipher type.`;
                if (attempts === 1) {
                    message += "\n\nüí° Think about what type of cipher rearranges letters but doesn't substitute them.";
                } else if (attempts === 3) {
                    message += "\n\nüí° The first word starts with 'T' and the second with 'C'.";
                } else if (attempts >= maxAttempts) {
                    message = "üí° Hint: The answer is 'TRANSPOSITION CIPHER'";
                }
                
                if (window.Feedback) {
                    Feedback.showError(message, 4000);
                } else {
                    alert(message);
                }
            }
            return false;
        });
        
        function skipAnimation() {
            $(".hiders").hide();
            $("#cipher_text_note, #cipher_text_input_div").stop(true, true).show();
            $(".skip-animation").hide();
        }
    </script>
</body>

</html>